ô
rD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\Controllers\ProductoController.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
Controllers %
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public		 

class		 
ProductoController		 #
:		$ %

Controller		& 0
{

 
private 
readonly 
IProductoRepository ,
_productoRepository- @
;@ A
public 
ProductoController !
(! "
IProductoRepository" 5
productosRepository6 I
)I J
{ 	
_productoRepository 
=  !
productosRepository" 5
;5 6
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetAllAsync) 4
(4 5
)5 6
{ 	
var 
	productos 
= 
await !
_productoRepository" 5
.5 6
GetAllAsync6 A
(A B
)B C
;C D
if 
( 
	productos 
is 
not 
null  $
&&% '
	productos( 1
.1 2
Count2 7
>8 9
$num: ;
); <
{ 
return 
Ok 
( 
	productos #
)# $
;$ %
} 
return 
NotFound 
( 
) 
; 
} 	
[   	
HttpGet  	 
]   
[!! 	
Route!!	 
(!! 
$str!! 
)!! 
]!! 
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (
GetAsync"") 1
(""1 2
int""2 5
id""6 8
)""8 9
{## 	
var$$ 
producto$$ 
=$$ 
await$$  
_productoRepository$$! 4
.$$4 5
GetAsync$$5 =
($$= >
id$$> @
)$$@ A
;$$A B
if&& 
(&& 
producto&& 
==&& 
null&&  
)&&  !
{'' 
return(( 
NotFound(( 
(((  
)((  !
;((! "
})) 
return++ 
Ok++ 
(++ 
producto++ 
)++ 
;++  
},, 	
}.. 
}// ÷
kD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\DAL\IProductoRepository.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
DAL 
{ 
public 

	interface 
IProductoRepository (
{ 
Task 
< 
	Productos 
? 
> 
GetAsync !
(! "
int" %
id& (
)( )
;) *
Task 
< 
List 
< 
	Productos 
> 
> 
GetAllAsync )
() *
)* +
;+ ,
}		 
}

 ˛
jD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\DAL\ProductoRepository.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
DAL 
{ 
public 

class 
ProductoRepository #
:$ %
IProductoRepository& 9
{		 
private

 
readonly

 
ProductosContext

 )
_context

* 2
;

2 3
public 
ProductoRepository !
(! "
ProductosContext" 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
public 
Task 
< 
List 
< 
	Productos "
>" #
># $
GetAllAsync% 0
(0 1
)1 2
{ 	
if 
( 
_context 
. 
	Productos "
is# %
not& )
null* .
). /
{ 
return 
_context 
.  
	Productos  )
.) *
ToListAsync* 5
(5 6
)6 7
;7 8
} 
else 
{ 
List 
< 
	Productos 
> 

listaVacia  *
=+ ,
new- 0
List1 5
<5 6
	Productos6 ?
>? @
(@ A
)A B
;B C
return 
Task 
. 

FromResult &
(& '

listaVacia' 1
)1 2
;2 3
} 
} 	
public 
async 
Task 
< 
	Productos #
?# $
>$ %
GetAsync& .
(. /
int/ 2
id3 5
)5 6
{   	
if!! 
(!! 
_context!! 
.!! 
	Productos!! !
is!!" $
not!!% (
null!!) -
)!!- .
{"" 
return## 
await## 
_context## %
.##% &
	Productos##& /
.##/ 0
	FindAsync##0 9
(##9 :
id##: <
)##< =
;##= >
}$$ 
return%% 
null%% 
;%% 
}&& 	
}'' 
},, Ñ
nD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\DAL\ProductoRepositoryFake.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
DAL 
{ 
public 

class "
ProductoRepositoryFake '
:( )
IProductoRepository* =
{ 
private 
readonly 
List 
< 
	Productos '
>' (
repo) -
=. /
new0 3
(4 5
)5 6
;6 7
public		 "
ProductoRepositoryFake		 %
(		% &
)		& '
{

 	
for 
( 
int 
i 
= 
$num 
; 
i 
< 
$num  #
;# $
i% &
++& (
)( )
{ 
Random 
r 
= 
new 
( 
)  
;  !
repo 
. 
Add 
( 
new 
	Productos &
(& '
)' (
{ 
Id 
= 
( 
i 
+ 
$num 
)  
,  !
Nombre 
= 
$" 
$str (
{( )
i) *
++ ,
$num- .
}. /
"/ 0
,0 1
Precio 
= 
( 
double $
)$ %
i% &
*' (
Math) -
.- .
PI. 0
,0 1
	FechaAlta 
= 
new  #
DateTime$ ,
(, -
$num- 1
,1 2
$num3 5
,5 6
r7 8
.8 9
Next9 =
(= >
$num> ?
,? @
$numA C
)C D
)D E
} 
) 
; 
} 
} 	
public "
ProductoRepositoryFake %
(% &
string& ,#
CreacionRepositoriVacio- D
)D E
{ 	
} 	
public 
Task 
< 
	Productos 
? 
> 
GetAsync  (
(( )
int) ,
id- /
)/ 0
{ 	
if 
( 
repo 
is 
not 
null 
)  
{ 
var 
product 
= 
repo "
." #
FirstOrDefault# 1
(1 2
p2 3
=>4 6
p7 8
.8 9
Id9 ;
==< >
id? A
)A B
;B C
return 
Task 
. 

FromResult &
(& '
product' .
). /
;/ 0
}   
return!! 
Task!! 
.!! 

FromResult!! "
<!!" #
	Productos!!# ,
?!!, -
>!!- .
(!!. /
null!!/ 3
)!!3 4
;!!4 5
}"" 	
public$$ 
Task$$ 
<$$ 
List$$ 
<$$ 
	Productos$$ "
>$$" #
>$$# $
GetAllAsync$$% 0
($$0 1
)$$1 2
{%% 	
return&& 
Task&& 
.&& 

FromResult&& "
(&&" #
repo&&# '
)&&' (
;&&( )
}'' 	
}(( 
})) Ø
hD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\DAL\ProductosContext.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
DAL 
{ 
public 

class 
ProductosContext !
:" #
	DbContext$ -
{ 
public 
ProductosContext 
(  
DbContextOptions  0
<0 1
ProductosContext1 A
>A B
optionsC J
)J K
:		 
base		 
(		 
options		 
)		 
{

 	
} 	
public 
DbSet 
< 
Models 
. 
	Productos %
>% &
?& '
	Productos( 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
} 
} ∂
{D:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\Migrations\20221019075811_InitialCreate.cs
	namespace 	
GrupoC
 
. 
Producto 
. 

Migrations $
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str !
,! "
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Nombre 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
nullableI Q
:Q R
falseS X
)X Y
,Y Z
Precio 
= 
table "
." #
Column# )
<) *
double* 0
>0 1
(1 2
type2 6
:6 7
$str8 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
TipoProducto  
=! "
table# (
.( )
Column) /
</ 0
int0 3
>3 4
(4 5
type5 9
:9 :
$str; @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
	FechaAlta 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= H
,H I
nullableJ R
:R S
trueT X
)X Y
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 3
,3 4
x5 6
=>7 9
x: ;
.; <
Id< >
)> ?
;? @
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name   
:   
$str   !
)  ! "
;  " #
}!! 	
}"" 
}## ï
dD:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\Models\Productos.cs
	namespace 	
GrupoC
 
. 
Producto 
. 
Models  
{ 
public 

class 
	Productos 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
(		 
ErrorMessage		 
=		  
$str		! 9
)		9 :
]		: ;
public

 
string

 
?

 
Nombre

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 9
)9 :
]: ;
public 
double 
Precio 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 7
)7 8
]8 9
public 
int 
TipoProducto 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 
? 
	FechaAlta "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ∑!
[D:\ProyectosProgramacion\VS\ProyectoMicroserviciosEquipoC\GrupoC\GrupoC.Producto\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
SecretClientOptions

 
options

 
=

 
new

 !
SecretClientOptions

" 5
(

5 6
)

6 7
{ 
Retry 	
=
 
{ 
Delay 
= 
TimeSpan 
. 
FromSeconds #
(# $
$num$ %
)% &
,& '
MaxDelay 
= 
TimeSpan 
. 
FromSeconds '
(' (
$num( *
)* +
,+ ,

MaxRetries 
= 
$num 
, 
Mode 
= 
	RetryMode 
. 
Exponential $
} 
} 
; 
string 
secretValue 
= 
$str 
; 
string 
? 
Uri 
= 
Environment 
. "
GetEnvironmentVariable 0
(0 1
$str1 @
,@ A%
EnvironmentVariableTargetB [
.[ \
User\ `
)` a
;a b
if 
( 
Uri 
is 

not 
null 
) 
{ 
var 
client 
= 
new 
SecretClient !
(! "
new" %
Uri& )
() *
Uri* -
)- .
,. /
new0 3"
DefaultAzureCredential4 J
(J K
)K L
,L M
optionsN U
)U V
;V W
KeyVaultSecret 
secret 
= 
client "
." #
	GetSecret# ,
(, -
Environment- 8
.8 9"
GetEnvironmentVariable9 O
(O P
$strP a
,a b%
EnvironmentVariableTargetc |
.| }
User	} Å
)
Å Ç
)
Ç É
;
É Ñ
secretValue 
= 
secret 
. 
Value 
; 
} 
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder## 
.## 
Services## 
.## #
AddEndpointsApiExplorer## (
(##( )
)##) *
;##* +
builder$$ 
.$$ 
Services$$ 
.$$ 
AddSwaggerGen$$ 
($$ 
)$$  
;$$  !
builder%% 
.%% 
Services%% 
.%% 
	AddScoped%% 
<%% 
IProductoRepository%% .
,%%. /
ProductoRepository%%0 B
>%%B C
(%%C D
)%%D E
;%%E F
builder&& 
.&& 
Services&& 
.&& 
AddDbContext&& 
<&& 
ProductosContext&& .
>&&. /
(&&/ 0
options&&0 7
=>&&8 :
options'' 
.'' 
UseSqlServer'' (
(''( )
secretValue'') 4
)''4 5
)(( 
;(( 
var** 
app** 
=** 	
builder**
 
.** 
Build** 
(** 
)** 
;** 
if-- 
(-- 
app-- 
.-- 
Environment-- 
.-- 
IsDevelopment-- !
(--! "
)--" #
)--# $
{.. 
app// 
.// 

UseSwagger// 
(// 
)// 
;// 
app00 
.00 
UseSwaggerUI00 
(00 
)00 
;00 
}11 
app44 
.44 
UseAuthorization44 
(44 
)44 
;44 
app66 
.66 
MapControllers66 
(66 
)66 
;66 
app88 
.88 
Run88 
(88 
)88 	
;88	 
